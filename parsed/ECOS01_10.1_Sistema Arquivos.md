\\--- PÁGINA 1 \\---  # **Sistemas Operacionais**  ## **Sistema de Arquivos**  Prof. Otávio Gomes   otavio.gomes@unifei.edu.br   \\--- PÁGINA 2 \\---  ## **Sistema de Arquivos**  * É responsável pelo mapeamento do espaço de endereçamento para o armazenamento secundário (disco).   * Define a maneira como os dados serão gravados e gerenciados nos dispositivos de armazenamento acessados pelo computador.   * O sistema operacional abstrai, das propriedades físicas de seus dispositivos de armazenamento, a definição de uma unidade lógica de armazenamento, o **arquivo**.   * A tabela de arquivos é utilizada pelo Sistema Gerenciador de Arquivos para guardar a organização física dos arquivos.  \\--- PÁGINA 3 \\---  ## **Sistema de Arquivos**  * Os arquivos são mapeados pelo sistema operacional para dispositivos físicos. Esses dispositivos físicos são usualmente não voláteis; portanto, os conteúdos são persistentes entre reinicializações do sistema.   * Um **arquivo** é uma coleção nomeada de informações relacionadas que são gravadas em memória secundária. Da perspectiva do usuário, um arquivo é a menor unidade de armazenamento lógico secundário. Podem ser numéricos, alfabéticos, alfanuméricos ou binários.   * **Diretórios** são utilizados pelo usuário para organizar os arquivos.  \\--- PÁGINA 4 \\---  ## **Sistema de Arquivos**  ### **Requisitos de armazenamento persistente**  * Armazenar e recuperar \\- big data:     * 3 Vs \\- Volume, Variedade e Velocidade.   * A informação gerada por um processo continua existindo após a finalização do processo;   * Dar acesso à informação a múltiplos processos:     * Concorrência;     * Informações independentes dos processos.  \\--- PÁGINA 5 \\---  ## **Sistema de Arquivos: Sistema Operacional \\- Conjunto de serviços**  * Parte do SO responsável pelo tratamento dos arquivos;   * Uma das partes mais visíveis ao usuário.  \\[Imagem: Diagrama da estrutura de um sistema computacional\\]   A imagem, já vista anteriormente, mostra a estrutura em camadas de um sistema, destacando que o \\\"file systems\\\" (sistema de arquivos) é um dos serviços centrais oferecidos pelo sistema operacional, acessado através de chamadas de sistema.   \\--- PÁGINA 6 \\---  ## **Sistema de Arquivos**  * **Ponto de vista do usuário (alto nível)**     * Interface \\- como os arquivos aparecem / são apresentados;     * Como são nomeados e protegidos;     * Operações que podem ser realizadas.   * **Ponto de vista do Sistema Operacional (baixo nível)**     * Como os arquivos são armazenados fisicamente;     * Como os arquivos são referenciados (links).  \\--- PÁGINA 7 \\---  ## **Sistema de Arquivos: Arquivos \\- Armazenamento persistente**  * Criados pelos processos;   * Processos podem ler ou escrever em arquivos ou criar novos arquivos;   * Informações armazenadas devem ser persistentes \\- Não podem ser afetadas pela criação ou finalização de um processo (dependência).   * Arquivos são gerenciados pelo Sistema Operacional;   * Arquivos são estruturados, nomeados, acessados, utilizados, protegidos, implementados e gerenciados por meio de chamadas de sistema.  \\--- PÁGINA 8 \\---  ## **Sistema de Arquivos: Nomes de arquivos**  * Quando criados são fornecidos nomes aos arquivos e os mesmos são referenciados por meio de seus nomes;   * Tamanho: até 255 caracteres;   * Restrição: MS-DOS aceita de 1-8 caracteres;   * Letras, números, caracteres especiais podem compor nomes de arquivos:     * Caracteres permitidos: A-Z, a-z, 0-9, $, %, \\`, @, {, }, \\~, \\`, \\!, \\#, (, ), &     * Caracteres não-permitidos: ?, \\*, , \\\\, \\\", |, \\<, \\>, :  \\--- PÁGINA 9 \\---  ## **Sistema de Arquivos: Nomes de arquivos**  * Alguns são sensíveis \\- **Case Sensitive**   * UNIX é sensível, MS-DOS não é sensível:     * Win95 / WinNT / Win2000 herdaram características do sistema de arquivos do MS-DOS.     * Em particular, WinNT / Win2000 utilizam um sistema de arquivos próprio \\- NTFS (New Technology File System)  \\--- PÁGINA 10 \\---  ## **Sistema de Arquivos: Extensão dos arquivos**  * Alguns SOs suportam uma extensão relacionada:     * **MS-DOS:**       * 1-3 caracteres, suporta apenas uma extensão       * 8 caracteres para o nome \\+ 3 para extensão     * **UNIX:**       * Mais de 3 caracteres, permite mais de uma extensão ou sem extensão       * Nome \\+ extensões não pode ser maior que 255 caracteres  \\--- PÁGINA 11 \\---  ## **Sistema de Arquivos: Extensão dos arquivos**  * Geralmente associada a algum aplicativo: doc, zip, jpg;   * SO pode ou não associar as extensões aos aplicativos:     * Unix não realiza a associação;     * Windows realiza a associação;     * Linux associa algumas:       * Facilidade de uso;       * Apenas no GUI.  \\--- PÁGINA 12 \\---  ## **Sistema de Arquivos: Extensão dos arquivos**  \\[Imagem: Ícones de extensões de arquivo e tabela\\]   A imagem exibe uma coleção de ícones coloridos representando tipos de arquivos comuns (JPG, MP3, PDF, DOC, ZIP, etc.). Ao lado, uma tabela lista tipos de arquivo (executável, código fonte, texto, etc.), suas extensões usuais (exe, c, java, txt, doc) e suas funções.   \\--- PÁGINA 13 \\---  ## **Sistema de Arquivos: Estrutura de arquivos**  1. **Sequência não-estruturada de bytes:**      * Para o SO são apenas conjuntos de bytes;      * SO não se importa com o conteúdo do arquivo;      * O significado deve ser dado pelas aplicações;      * **Vantagem \\- Flexibilidade:**        * Os usuários colocam o que quiserem;        * Nomeiam arquivos como quiserem.      * Utilizado em UNIX e Windows.  \\--- PÁGINA 14 \\---  ## **Sistema de Arquivos: Estrutura de arquivos**  2. **Sequência de registros de tamanho fixo:**      * Cada qual com alguma estrutura interna (p.ex. 80 e 132 caracteres);      * Leitura/escrita são realizadas em registros:        * Lê, sobrescreve ou adiciona um registro;      * Utilizado em SOs mais antigos \\- mainframes;      * 80 caracteres do cartão perfurado.      * Nenhum SO atual utiliza esse esquema.  \\--- PÁGINA 15 \\---  ## **Sistema de Arquivos: Estrutura de arquivos**  3. **Árvores de registros (tamanho variado):**      * Cada parte do arquivo possui um campo chave em uma posição fixa;      * O arquivo consiste nesta árvore;      * Operação: obter o registro com uma certa chave;      * O SO decide onde colocar novos registros \\- não o usuário.      * Utilizado em mainframes atuais.  \\--- PÁGINA 16 \\---  ## **Sistema de Arquivos: Estrutura de arquivos**  \\[Imagem: Três estruturas de arquivo\\]   (a) Sequência de bytes: Uma coluna de pequenos retângulos, cada um representando 1 byte.   (b) Sequência de registros: Uma coluna de retângulos maiores, cada um representando um registro de tamanho fixo.   (c) Árvore de registros: Uma estrutura em árvore onde cada nó contém múltiplos registros, e os nós são organizados com base em chaves para permitir buscas eficientes.   \\--- PÁGINA 17 \\---  ## **Sistema de Arquivos: Tipos de arquivos**  * Arquivos regulares – informações dos usuários;   * Diretórios – arquivos para estruturar o sistema de arquivos;   * Arquivos do sistema: /dev e /proc   * Arquivos de caracteres especiais (input/output).   * Arquivos especiais de bloco (disks).  \\[Imagem: Tabela de tipos de arquivo no Unix/Linux\\]   A tabela mostra o símbolo usado na listagem de diretórios e o tipo de arquivo correspondente: \\- (Arquivo regular), d (Diretório), c (Dispositivo de caractere), b (Dispositivo de bloco), s (Socket), p (Pipe), l (Link simbólico).   \\--- PÁGINA 18 \\---  ## **Sistema de Arquivos: Bloco de controle de arquivo (FCB)**  \\[Imagem: Estrutura de um arquivo executável e um arquivo objeto\\]   (a) Arquivo executável: Contém um cabeçalho (Header) e o código do programa.   (b) Arquivo objeto (archive): Contém múltiplos módulos objeto, cada um com seu próprio cabeçalho, texto, dados e tabela de símbolos.   *O FCB armazena metadados como permissões, datas, dono, tamanho e ponteiros para os blocos de dados.*  \\--- PÁGINA 19 \\---  ## **Sistema de Arquivos: Tipos de arquivos regulares**  1. **ASCII:**      * Consistem de linhas de texto com CR+LF (Carriage Return and Line Feed);      * Facilitam integração de programas (via arquivo);      * Podem ser exibidos e impressos como são;      * Podem ser editados em qualquer editor de texto;      * Mais portável e inter-operável.      * Manuseio / Impressão de arquivos: more, cat, less.  \\--- PÁGINA 20 \\---  ## **Sistema de Arquivos: Tipos de arquivos regulares**  2. **Binário:**      * Todo arquivo não-ASCII;      * Estrutura interna conhecida apenas pelos aplicativos que os utilizam, por exemplo: programa executável.  \\[Imagem: Arquivo ASCII vs. Binário no Bloco de Notas\\]   A imagem mostra um arquivo .ini (ASCII) aberto e legível no Bloco de Notas, em contraste com um arquivo .exe e um .doc (binários), que aparecem como uma sequência de caracteres sem sentido no mesmo editor.   \\--- PÁGINA 21 \\---  ## **Sistema de Arquivos: Atributos de Arquivos**  * Os atributos de um arquivo variam de um sistema operacional para outro, mas normalmente são os seguintes:     * Nome.     * Identificador.     * Tipo.     * Locação.     * Tamanho.     * Proteção.     * Hora, data e identificação do usuário.  \\--- PÁGINA 22 \\---  ## **Sistema de Arquivos: Atributos de arquivos**  \\[Imagem: Exemplos de atributos de arquivo\\]   O slide mostra três exemplos de como os atributos de arquivo são gerenciados: uma janela do Windows para definir atributos (Read-Only, Hidden, etc.), uma tabela de permissões octais do Linux (ex: 777 é rwxrwxrwx) e uma lista de atributos do Linux (como 'a' para append only, 'c' para compressed).   \\--- PÁGINA 23 \\---  ## **Sistema de Arquivos: Atributos de arquivos**  * Além do nome e dados, todo arquivo possui outras informações a respeito dele \\- **atributos** (ou metadados).   * A lista de atributos varia de SO para SO.  \\[Imagem: Detalhe de uma listagem de arquivo no Linux\\]   A imagem destaca os componentes de uma linha de saída do comando ls \\-l no Linux, como \\-rwxr-xr-x+, mostrando o tipo de arquivo, as permissões para dono, grupo e outros, a contagem de links, o dono, o grupo, o tamanho, a data de modificação e o nome do arquivo.   \\--- PÁGINA 24 \\---  ## **Sistema de Arquivos: Atributos de arquivos**  \\[Imagem: Estruturas de dados de arquivo no Kernel do Linux\\]   Um diagrama complexo mostrando as estruturas de dados do kernel do Linux (task\\_struct, file, dentry, inode, super\\_block) e como elas se inter-relacionam para gerenciar um arquivo aberto por um processo.   \\--- PÁGINA 25 \\---  ## **Sistema de Arquivos: Acesso aos Arquivos**  * **SOs mais antigos:**     * Apenas acesso sequencial no disco;     * Leitura seguindo a ordem byte a byte, ou registro a registro.   * **SOs mais modernos:**     * Realizam acesso aleatório no disco;     * Acesso realizado fora de ordem através de uma chave, por exemplo, utilizando a base de dados de uma empresa aérea.  \\--- PÁGINA 26 \\---  ## **Acesso aos Arquivos**  \\[Imagem: Abrindo um arquivo\\]   Um diagrama mostrando que a chamada open() no espaço do usuário leva o kernel a buscar na estrutura de diretórios do armazenamento secundário para encontrar o bloco de controle de arquivo (FCB) e carregá-lo na memória.   \\--- PÁGINA 27 \\---  ## **Acesso aos Arquivos: Métodos para especificar o ponto de início da leitura**  * read: indica a posição do arquivo a ser lido, a partir do qual a leitura será sequencial.   * seek:     * Marca a posição corrente, executa a instrução seek e realiza a leitura sequencial.     * Utilizado em Windows e Unix.  \\[Imagem: Ponteiro de posição de arquivo\\]   Uma ilustração de um arquivo com um ponteiro de posição atual, que pode ser movido (rewind, read or write) para o início ou para o fim.   \\--- PÁGINA 28 \\---  ## **Acesso aos Arquivos: Operações mais comuns (system calls)**  * **Create:** o arquivo é criado sem dados.   * **Delete:** o arquivo é removido do disco.   * **Open:** permite que o SO busque os atributos e a lista dos endereços de disco na memória.   * **Close:** libera o espaço ocupado pelo Open, também força que o último bloco de dados seja escrito no disco.   * **Read:** Lê do arquivo para um buffer.   * **Write:** escreve dados no arquivo.   * **Append:** escreve dados ao final do arquivo.   * **Seek:** para acesso aleatório \\- procura dados.  \\--- PÁGINA 29 \\---  ## **Acesso aos Arquivos: Operações mais comuns (system calls)**  * **Get attributes:** obtém os atributos de um arquivo.   * **Set attributes:** altera os atributos de um arquivo.  \\[Imagem: Tabela de chamadas de sistema\\]   Uma tabela organizando várias chamadas de sistema do Unix/Linux por categoria: Operações de Somente Leitura, Operações de Modificação em Arquivos Regulares, Diretórios e Inodes.   \\--- PÁGINA 30 \\---  ## **Acesso aos Arquivos**  \\[Imagem: Tabela de Chamadas de Sistema POSIX\\]   Uma tabela mais detalhada mostrando as principais chamadas de sistema POSIX para gerenciamento de processos, arquivos, diretórios e outras funções diversas.   \\--- PÁGINA 31 \\---  ## **Sistema de Arquivos: Arquivos mapeados na memória**  * Alguns SO mapeiam arquivos no espaço de endereçamento (virtual) de um processo.   * Acesso mais rápido ao arquivo, que pode ser lido/escrito como um arranjo de bytes na memória.   * Arquivos modificados são gravados no disco ao final do uso. Ex.: bibliotecas compartilhadas.   * System calls: map e unmap.  \\--- PÁGINA 32 \\---  ## **Sistema de Arquivos: Arquivos mapeados na memória**  \\[Imagem: Mapeamento de Arquivos na Memória\\]   Dois diagramas ilustrando o mapeamento de arquivos. O primeiro mostra um arquivo sendo mapeado em uma região do espaço de endereço de um processo. O segundo mostra dois processos compartilhando memória através do mapeamento do mesmo arquivo em seus respectivos espaços de endereço.   \\--- PÁGINA 33 \\---  ## **Sistema de Arquivos: Arquivos mapeados na memória**  * Funciona melhor com segmentação.   * Facilita o mapeamento através da utilização de segmentos.  \\--- PÁGINA 34 \\---   Este slide ilustra como um programa pode mapear um arquivo de entrada (abc) e um de saída (xyz) como segmentos distintos em seu espaço de endereço.   \\--- PÁGINA 35 \\---   Este slide mostra um diagrama mais detalhado do espaço de endereço de um processo com uma região de arquivo mapeado entre a pilha (stack) e o heap.   \\--- PÁGINA 36 \\---  ## **Sistema de Arquivos: Arquivos mapeados na memória**  * **Vantagens:**     * Compartilhamento e trabalho colaborativo.   * **Problemas:**     * Uso do espaço virtual para o arquivo;     * Sincronização;     * Arquivo pode ser maior que o espaço virtual \\- Alocação por partes.  \\--- PÁGINA 37 \\---  ## **Sistema de Arquivos: Diretórios**  * São arquivos que mantêm a estrutura do sistema de arquivos.  \\[Imagem: Sistema de Arquivos em Múltiplas Partições\\]   Um diagrama mostrando como um único sistema de arquivos lógico pode ser composto por diretórios e arquivos espalhados por múltiplas partições em diferentes discos físicos.   \\--- PÁGINA 38 \\---  ## **Sistema de Arquivos: Diretórios**  * São arquivos que mantêm a estrutura do sistema de arquivos.   * Podem ser organizados como: nível único, dois níveis e de modo hierárquico.  \\[Imagem: Estruturas de Diretório\\]   Três diagramas: (1) Diretório de nível único, com todos os arquivos sob a raiz. (2) Diretório de dois níveis, com um diretório de usuário para cada usuário. (3) Diretório hierárquico em árvore, permitindo subdiretórios.   \\--- PÁGINA 39 \\---  ## **Sistema de Arquivos: Diretórios \\- caminhos**  * Existem dois métodos para acessar os arquivos:     * **Caminho absoluto** \\- caminho desde a raiz.     * **Caminho relativo** \\- considera o diretório atual.  \\[Imagem: Tabela de Caminhos Relativos vs. Absolutos\\]   Uma tabela mostrando exemplos de como diferentes caminhos relativos (usando . e ..) se resolvem em caminhos absolutos, dado um diretório de trabalho atual.   \\--- PÁGINA 40 \\---  ## **Sistema de Arquivos: Diretórios**  \\[Imagem: Implementação de Nomes Longos em Diretórios\\]   Dois métodos são ilustrados: (a) In-line: o nome do arquivo é armazenado diretamente na entrada do diretório. (b) In a heap: a entrada do diretório contém um ponteiro para o nome do arquivo, que é armazenado em uma área separada (heap).   \\--- PÁGINA 41 \\---  ## **Sistema de Arquivos: Diretórios \\- Linux**  \\[Imagem: Exemplo de Estrutura de Diretórios no Linux\\]   Um diagrama de árvore mostrando a estrutura de diretórios do Linux, começando do diretório raiz (/) e se ramificando em /usr, /lib, /etc, etc., até chegar a um diretório de usuário /usr/jim.   \\--- PÁGINA 42 \\---   Este slide mostra duas maneiras de armazenar atributos de arquivos em uma entrada de diretório: (a) atributos diretamente na entrada; (b) um ponteiro para uma estrutura de dados separada (como um i-node) que contém os atributos.   \\--- PÁGINA 43 \\---  ## **Sistema de Arquivos: Diretórios \\- Linux**  \\[Imagem: Estrutura de Diretórios Padrão do Linux\\]   Uma tabela detalhada explicando o propósito dos principais diretórios do sistema de arquivos Linux, como /bin (binários essenciais), /etc (arquivos de configuração), /home (diretórios de usuário), /var (dados variáveis), etc.   \\--- PÁGINA 44 \\---  ## **Sistema de Arquivos: Diretórios \\- Links**  * Permite que um arquivo apareça em mais de um diretório.   * **Hard Link:**     * Incrementa o contador de links no i-node;     * Nenhum arquivo é realmente removido enquanto seu contador for maior que zero.   * **Soft Link:**     * Ponteiro para um arquivo em outro diretório;     * Não incrementa o contador.  \\[Imagem: Hard Link vs. Soft Link\\]   Um diagrama mostrando my-hard-link e myfile.txt apontando para o mesmo inode. my-soft-link aponta para o nome do arquivo myfile.txt.   \\--- PÁGINA 45 \\---  ## **Sistema de Arquivos: Diretórios \\- Links**  * **Soft Link:**     * **Vantagem:**       * Não precisa copiar o mesmo arquivo para outro local;       * Economia de espaço.     * **Desvantagem:**       * Se ocorrer a remoção do arquivo original sem remover o link → link quebrado.  \\--- PÁGINA 46 \\---  ## **Sistema de Arquivos: Diretórios \\- Links**  ### **Hard links vs. Symbolic links**  * **Unlink (hard link):**     * Remove uma entrada (arquivo) no diretório.     * Decrementa o contador de links do arquivo.     * Se após a remoção o contador for igual a zero, o arquivo correspondente estava somente neste diretório e será removido do sistema de arquivos.  \\--- PÁGINA 47 \\---   Este slide mostra um diagrama mais visual comparando hard links (referência direta ao inode) e soft links (referência indireta ao nome do arquivo).   \\--- PÁGINA 48 \\---  ## **Bibliografia**  * TANENBAUM, Andrew S; BOS, Herbert. **Sistemas operacionais modernos.** 4a ed. São Paulo: Pearson Education do Brasil, 2016\\. Capítulo 4\\.   * DEITEL, H.M; DEITEL, P.J; CHOFFNES,D.R. **Sistemas Operacionais.** 3a ed. São Paulo: Pearson Prentice Hall, 2005\\. Capítulos 12-13.  \\--- PÁGINA 49 \\---   Slide final com o logo da universidade e contato do professor.